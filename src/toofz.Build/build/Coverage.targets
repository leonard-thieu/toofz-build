<Project>
  <UsingTask AssemblyFile="@(TasksAssemblyFile)" TaskName="toofz.Build.OpenCover" />

  <Target Name="Coverage">
    <PropertyGroup>
      <VSTestArgs>$(TargetPath)</VSTestArgs>
      <VSTestWorkingDir>$(TargetDir)</VSTestWorkingDir>
      <OpenCoverFilter>+[$(TargetName.Replace('.Tests', ''))]* -[$(TargetName)]*</OpenCoverFilter>
    </PropertyGroup>

    <OpenCover ToolPath="$(OpenCoverToolPath)"
               Register="true"
               Target="$(VSTestPath)"
               TargetArgs="$(VSTestArgs)"
               TargetWorkingDir="$(VSTestWorkingDir)"
               ReturnTargetCode="true"
               Filter="$(OpenCoverFilter)"
               ExcludeByAttribute="$(OpenCoverExcludeByAttribute)"
               Output="@(CodeCoverageResults)"
               OldStyle="$(OpenCoverOldStyle)" />
  </Target>
</Project>
