<Project>
  <PropertyGroup>
    <TasksAssemblyFilePath>$(BuildToolsPath)$(MSBuildThisFileName).dll</TasksAssemblyFilePath>
  </PropertyGroup>

  <ItemGroup>
    <TasksAssemblyFile Include="$(TasksAssemblyFilePath)" Condition="Exists('$(TasksAssemblyFilePath)')" />
    <TasksAssemblyFile Include="$(TargetPath)" Condition="!Exists('$(TasksAssemblyFilePath)')" />
  </ItemGroup>

  <Target Name="_BeforeGetAssemblyAttributes"
          BeforeTargets="GetAssemblyAttributes">
    <PropertyGroup>
      <AssemblyTitle Condition="'$(Title)' != ''">$(Title)</AssemblyTitle>
    </PropertyGroup>
  </Target>

  <Target Name="_AfterGetAssemblyVersion"
          AfterTargets="GetAssemblyVersion">
    <Exec Command="git rev-parse --short HEAD" ConsoleToMSBuild="true">
      <Output TaskParameter="ConsoleOutput" PropertyName="_GitShortCommitHash" />
    </Exec>
    
    <PropertyGroup>
      <InformationalVersion>$(Version)+$(_GitShortCommitHash)</InformationalVersion>
    </PropertyGroup>
  </Target>

  <Import Project="Test.targets" />
  <Import Project="PublishPackage.targets" />
  <Import Project="EmbedSourceFiles.targets" />
</Project>
